# $Id$
#
# Ce fichier sert √† faciliter et automatiser la mise en prod de la prochaine
# release. On y indique les requ√®tes √† appliquer √† la base de don√©e (pour la
# mettre √† jour), et √©ventuellement d'autres informations utiles.
# Il faut donc veiller √† le tenir √† jour √† chaque modification de la base de
# donn√©es.
#
# ATTENTION A L'ORDRE DES REQUETES:
# ---------------------------------
# Elles doivent √™tre de la plus ancienne √† la plus r√©cente dans le bloc de la
# release en cours.
#
# FONCTIONNEMENT
# --------------
# Pendant la phase de d√©veloppement suivant une release, on √©crit les requ√®tes
# n√©cessaires √† la mise √† jour des bases de donn√©es (depuis la release jusqu'√†
# la release suivante).
#
# Lors de la mise en production de la release suivante (release + 1), on
# applique ce fichier aux bases de donn√©es pour les mettre √† jour, puis on
# renomme le fichier en RELEASE_NOTES.OLD, et on entame un nouveau
# RELEASE_NOTES (en pr√©vision de release + 2).
#
# TODO IMPORTANT !!
# -----------------
# √† chaque RELEASE, ne pas oublier de:
#    * Mettre √† jour les feeds ipkg du zaurus,
#    * Updater les applications desktop

####################################
# Ne pas enlever
SET AUTOCOMMIT=0;
BEGIN;
TRUNCATE TABLE IdHashTable;
####################################

ALTER TABLE Actor DROP _PaymentCondition;
ALTER TABLE AbstractDocument DROP _PaymentCondition;
ALTER TABLE SupplierCustomer DROP _Option;
ALTER TABLE SupplierCustomer DROP _TotalDays;
ALTER TABLE SupplierCustomer DROP _Modality;
ALTER TABLE SupplierCustomer ADD _TermsOfPayment INT(11) NOT NULL DEFAULT 0 AFTER _Customer;

DROP TABLE IF EXISTS TermsOfPayment;
CREATE TABLE TermsOfPayment (
  _Id int(11) unsigned NOT NULL default 0,
  _DBId int(11) default 0,
  _Name VARCHAR(255) DEFAULT NULL,
  PRIMARY KEY (_Id)
) TYPE=InnoDB CHARSET=latin1;

DROP TABLE IF EXISTS TermsOfPaymentItem;
CREATE TABLE TermsOfPaymentItem (
  _Id int(11) unsigned NOT NULL default 0,
  _DBId int(11) default 0,
  _PercentOfTotal DECIMAL(10,2) DEFAULT NULL,
  _PaymentDelay INT(11) NOT NULL DEFAULT 0,
  _PaymentOption INT(3) NOT NULL DEFAULT 0,
  _PaymentEvent INT(3) NOT NULL DEFAULT 0,
  _TermsOfPayment INT(11) NOT NULL DEFAULT 0,
  PRIMARY KEY (_Id)
) TYPE=InnoDB CHARSET=latin1;

CREATE INDEX _TermsOfPayment ON TermsOfPaymentItem (_TermsOfPayment);

insert into TermsOfPayment values (1, NULL, 'ChËque 30 jours net');
insert into TermsOfPaymentItem values (1, NULL, 100, 30, 1, 6, 1);
update SupplierCustomer set _TermsOfPayment=1 where 1;

####################################
# Ne pas enlever
COMMIT;
####################################
