# $Id$
#
# Ce fichier sert à faciliter et automatiser la mise en prod de la prochaine
# release. On y indique les requètes à appliquer à la base de donée (pour la
# mettre à jour), et éventuellement d'autres informations utiles.
# Il faut donc veiller à le tenir à jour à chaque modification de la base de
# données.
#
# ATTENTION A L'ORDRE DES REQUETES:
# ---------------------------------
# Elles doivent être de la plus ancienne à la plus récente dans le bloc de la
# release en cours.
#
# FONCTIONNEMENT
# --------------
# Pendant la phase de développement suivant une release, on écrit les requètes
# nécessaires à la mise à jour des bases de données (depuis la release jusqu'à
# la release suivante).
#
# Lors de la mise en production de la release suivante (release + 1), on
# applique ce fichier aux bases de données pour les mettre à jour, puis on
# renomme le fichier en RELEASE_NOTES.OLD, et on entame un nouveau
# RELEASE_NOTES (en prévision de release + 2).
#
# TODO IMPORTANT !!
# -----------------
# à chaque RELEASE, ne pas oublier de:
#    * Mettre à jour les feeds ipkg du zaurus,
#    * Updater les applications desktop

####################################
# Ne pas enlever
SET AUTOCOMMIT=0;
BEGIN;
TRUNCATE TABLE IdHashTable;
####################################

set @id=(select IFNULL(max(_Id),0) from Incoterm);
insert into Incoterm values (@id+1, NULL, "FD", "Free Domicile", 0, 1);

# migration CommercialName / ScientificName
ALTER TABLE Product ADD _ScientificName VARCHAR(255) DEFAULT NULL AFTER _CommercialName;
UPDATE Product SET _ScientificName=(SELECT _StringValue_fr_FR FROM I18nString where _Id=_Name) WHERE _ClassName='RTWMaterial';
UPDATE I18nString i, Product p SET i._StringValue_fr_FR=p._CommercialName WHERE i._Id=p._Name and p._ClassName="RTWMaterial";
ALTER TABLE Product DROP _CommercialName;

# sell unit types
ALTER TABLE SellUnitType ADD _ConstName VARCHAR(255) DEFAULT NULL;
UPDATE SellUnitType SET _ConstName="SELLUNITTYPE_UB" WHERE _Id=1;
UPDATE SellUnitType SET _ConstName="SELLUNITTYPE_UC" WHERE _Id=2;
UPDATE SellUnitType SET _ConstName="SELLUNITTYPE_UE" WHERE _Id=3;
UPDATE SellUnitType SET _ConstName="SELLUNITTYPE_UR" WHERE _Id=4;
UPDATE SellUnitType SET _ConstName="SELLUNITTYPE_KG" WHERE _Id=5;
UPDATE SellUnitType SET _ConstName="SELLUNITTYPE_LI" WHERE _Id=6;
UPDATE SellUnitType SET _ConstName="SELLUNITTYPE_GA" WHERE _Id=7;
UPDATE SellUnitType SET _ConstName="SELLUNITTYPE_OZ" WHERE _Id=8;
UPDATE SellUnitType SET _ConstName="SELLUNITTYPE_MM" WHERE _Id=9;
UPDATE SellUnitType SET _ConstName="SELLUNITTYPE_CM" WHERE _Id=10;
UPDATE SellUnitType SET _ConstName="SELLUNITTYPE_MT" WHERE _Id=11;

####################################
# Ne pas enlever
COMMIT;
####################################
